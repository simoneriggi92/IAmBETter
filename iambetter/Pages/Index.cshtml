@page
@model IndexModel
@{
    ViewData["Title"] = "Bet of the day";
}

<h1>Generated BET</h1>

<h2>Predictions for @Model.Input.League.Name - Round @Model.Input.League.Round - Season  @Model.Input.League.Season</h2>

<table class="table table-striped">
    <thead>
        <tr>
            <th>Match</th>
            <th>Prediction</th>
            <th>Round</th>
        </tr>
    </thead>
    <tbody id="predictions-table">
        @foreach (var p in Model.Input.Predictions)
        {
            <tr>
                <td>@p.HomeTeam.Name vs @p.AwayTeam.Name</td>
                <td>@p.PredictedResult</td>
                <td>@p.Round</td>
            </tr>
        }
    </tbody>
</table>

@section Scripts {
    <script>
        async function fetchPredictions() {
            try {
                const response = await fetch('/Index?handler=Predictions');
                const data = await response.json();
                const tbody = document.getElementById('predictions-table');

                tbody.innerHTML = '';
               data.forEach(p => {
                    const row = `<tr>
                        <td>${p.teamA} vs ${p.teamB}</td>
                        <td>${p.predictedResult}</td>
                        <td>${p.round}%</td>
                    </tr>`;
                    tbody.innerHTML += row;
                });
            } catch (e) {
                console.error("Error fetching predictions:", e);
            }
        }

        setInterval(fetchPredictions, 60000); // 1 minute
    </script>
}
